# OMS系统框架实现要求

**文档版本**: v1.0  
**创建日期**: 2024-12-31  
**适用范围**: OMS订单管理系统  
**技术栈**: Next.js 14 + React + TypeScript + Tailwind CSS + shadcn/ui

---

## 一、技术栈要求

### 1.1 核心框架

| 技术 | 版本 | 用途 |
|------|------|------|
| Next.js | 14.x | React框架，支持SSR和SSG |
| React | 18.x | UI组件库 |
| TypeScript | 5.x | 类型安全 |
| Tailwind CSS | 3.x | CSS框架 |
| shadcn/ui | Latest | UI组件库 |

### 1.2 UI组件库

- **shadcn/ui**: 基于Radix UI的组件库
- **Lucide React**: 图标库
- **Sonner**: Toast通知组件
- **Recharts**: 图表库

### 1.3 国际化

- **自定义i18n系统**: 基于Context API
- **支持语言**: 中文(zh)、英文(en)
- **实时切换**: 无需刷新页面

---

## 二、项目结构

### 2.1 目录结构

```
OMS React/
├── app/                          # Next.js App Router
│   ├── layout.tsx               # 根布局
│   ├── page.tsx                 # 首页
│   ├── globals.css              # 全局样式
│   ├── dashboard/               # 仪表板模块
│   ├── orders/                  # 订单模块
│   ├── purchase/                # 采购模块
│   │   ├── pr/                  # 采购申请
│   │   ├── po/                  # 采购订单
│   │   ├── asn/                 # 预发货通知
│   │   ├── receipts/            # 收货
│   │   └── receipt-confirm/     # 收货确认
│   ├── product/                 # 商品模块
│   ├── inventory/               # 库存模块
│   ├── logistics/               # 物流模块
│   └── returns/                 # 退货模块
│
├── components/                   # 组件目录
│   ├── layout/                  # 布局组件
│   │   ├── main-layout.tsx      # 主布局
│   │   ├── sidebar.tsx          # 侧边栏
│   │   ├── header-simple.tsx    # 顶部导航
│   │   └── tenant-switcher.tsx  # 租户切换器
│   ├── ui/                      # shadcn/ui组件
│   │   ├── button.tsx
│   │   ├── input.tsx
│   │   ├── dialog.tsx
│   │   └── ...
│   ├── data-table/              # 数据表格组件
│   │   ├── data-table.tsx
│   │   ├── filter-bar.tsx
│   │   ├── advanced-search-dialog.tsx
│   │   └── batch-search-dialog.tsx
│   ├── purchase/                # 采购模块组件
│   │   ├── po-generation-dialog.tsx
│   │   ├── supplier-quote-dialog.tsx
│   │   └── sn-lot-management-dialog.tsx
│   ├── i18n-provider.tsx        # 国际化Provider
│   └── theme-provider.tsx       # 主题Provider
│
├── lib/                         # 工具库
│   ├── i18n.ts                  # 国际化配置
│   ├── utils.ts                 # 工具函数
│   ├── enums/                   # 枚举定义
│   │   └── po-status.ts         # PO状态枚举
│   └── purchase-sidebar-items.ts # 采购模块菜单
│
├── 产品需求文档/                 # 产品需求文档
│   ├── 列表与详情页产品需求与UI规范.md
│   ├── purchase-workflow.md
│   ├── PO_SYSTEM_IMPLEMENTATION_SUMMARY.md
│   └── PO_ALL_STATUS_ACTIONS_SUMMARY.md
│
├── docs/                        # 技术文档
│   ├── 系统框架实现要求.md       # 本文档
│   └── UI设计规范.md            # UI规范文档
│
├── public/                      # 静态资源
│   ├── svg/                     # SVG图标
│   └── fonts/                   # 字体文件
│
├── tailwind.config.ts           # Tailwind配置
├── next.config.mjs              # Next.js配置
├── tsconfig.json                # TypeScript配置
└── package.json                 # 依赖配置
```

### 2.2 模块划分

#### 核心模块

1. **Dashboard** - 仪表板
2. **Orders** - 订单管理
3. **Purchase** - 采购管理
4. **Product** - 商品管理
5. **Inventory** - 库存管理
6. **Logistics** - 物流管理
7. **Returns** - 退货管理

#### 支持模块

1. **Workspace** - 工作空间
2. **Merchant Management** - 商户管理
3. **Customer Management** - 客户管理
4. **Events** - 事件日志
5. **Integrations** - 第三方集成
6. **Automation** - 自动化工作流

---

## 三、配置文件

### 3.1 Next.js配置 (next.config.mjs)

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  // 优化开发体验
  experimental: {
    turbo: {
      // 启用 Turbopack (更快的打包器)
    },
  },
  // 减少编译时间
  swcMinify: true,
  // 优化图片
  images: {
    unoptimized: true
  },
  // TypeScript配置
  typescript: {
    ignoreBuildErrors: true,
  },
  // ESLint配置
  eslint: {
    ignoreDuringBuilds: false,
  },
  // 静态页面生成超时
  staticPageGenerationTimeout: 1000,
  // Webpack配置
  webpack: (config, { isServer }) => {
    if (!isServer) {
      config.resolve.fallback = {
        ...config.resolve.fallback,
        fs: false,
        net: false,
        tls: false,
      };
    }
    return config;
  },
};

export default nextConfig;
```

### 3.2 Tailwind配置 (tailwind.config.ts)

```typescript
import type { Config } from "tailwindcss"

const config = {
  darkMode: ["class"],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
} satisfies Config

export default config
```

### 3.3 TypeScript配置 (tsconfig.json)

```json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

---

## 四、布局系统

### 4.1 主布局结构

```tsx
// app/layout.tsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="zh" suppressHydrationWarning>
      <body>
        <ThemeProvider>
          <I18nProvider>
            <MainLayout>
              {children}
            </MainLayout>
          </I18nProvider>
        </ThemeProvider>
      </body>
    </html>
  )
}
```

### 4.2 主布局组件

```
┌─────────────────────────────────────────────┐
│ Header (固定顶部)                            │
│ - Logo                                      │
│ - 租户切换器                                 │
│ - 语言切换器                                 │
│ - 用户下拉菜单                               │
├──────────┬──────────────────────────────────┤
│          │                                  │
│ Sidebar  │  Main Content                    │
│ (固定)   │  (滚动区域)                       │
│          │                                  │
│ - 导航   │  - 页面内容                       │
│ - 菜单   │  - 数据表格                       │
│          │  - 表单                          │
│          │                                  │
└──────────┴──────────────────────────────────┘
```

### 4.3 响应式布局

- **桌面端** (≥1280px): 侧边栏展开，显示完整菜单
- **平板端** (768px-1279px): 侧边栏收起，显示图标
- **移动端** (<768px): 侧边栏隐藏，使用汉堡菜单

---

## 五、国际化系统

### 5.1 实现方式

```typescript
// lib/i18n.ts
export const translations = {
  zh: {
    // 中文翻译
    dashboard: '仪表板',
    orders: '订单管理',
    // ...
  },
  en: {
    // 英文翻译
    dashboard: 'Dashboard',
    orders: 'Orders',
    // ...
  }
}

export type Language = 'zh' | 'en'
export type TranslationKey = keyof typeof translations.zh
```

### 5.2 使用方式

```tsx
// 组件中使用
import { useI18n } from '@/components/i18n-provider'

function MyComponent() {
  const { t, language, setLanguage } = useI18n()
  
  return (
    <div>
      <h1>{t('dashboard')}</h1>
      <button onClick={() => setLanguage('en')}>
        Switch to English
      </button>
    </div>
  )
}
```

### 5.3 翻译组织

按模块组织翻译：

```typescript
export const translations = {
  zh: {
    // ==================== 通用 ====================
    actions: '操作',
    status: '状态',
    
    // ==================== 导航和模块 ====================
    dashboard: '仪表板',
    orders: '订单管理',
    
    // ==================== 采购模块 ====================
    purchaseRequest: 'Purchase Request',
    purchaseOrder: 'Purchase Order',
    
    // ==================== 状态 ====================
    draft: '草稿',
    pending: '待审批',
    approved: '已批准',
  },
  en: {
    // 对应的英文翻译
  }
}
```

---

## 六、状态管理

### 6.1 状态管理方案

- **React Context**: 全局状态(主题、语言、用户信息)
- **useState/useReducer**: 组件本地状态
- **URL State**: 筛选、分页等状态

### 6.2 Context Providers

```tsx
// 主题Provider
<ThemeProvider>
  {children}
</ThemeProvider>

// 国际化Provider
<I18nProvider>
  {children}
</I18nProvider>

// 用户Provider (可选)
<UserProvider>
  {children}
</UserProvider>
```

---

## 七、路由规范

### 7.1 路由结构

```
/                           # 首页
/dashboard                  # 仪表板
/orders                     # 订单列表
/orders/[id]                # 订单详情
/orders/create              # 创建订单
/purchase/pr                # 采购申请列表
/purchase/pr/[id]           # 采购申请详情
/purchase/pr/create         # 创建采购申请
/purchase/po                # 采购订单列表
/purchase/po/[id]           # 采购订单详情
/purchase/po/create         # 创建采购订单
```

### 7.2 路由命名规范

- **列表页**: `/module` (如 `/orders`)
- **详情页**: `/module/[id]` (如 `/orders/123`)
- **创建页**: `/module/create`
- **编辑页**: `/module/[id]/edit`
- **子模块**: `/module/submodule` (如 `/purchase/pr`)

---

## 八、数据表格系统

### 8.1 表格组件

- **DataTable**: 基础数据表格
- **DataTableWithStickyHeader**: 带固定表头的表格
- **FilterBar**: 筛选工具栏
- **AdvancedSearchDialog**: 高级搜索对话框
- **BatchSearchDialog**: 批量搜索对话框

### 8.2 表格功能

1. **筛选功能**
   - 快速搜索
   - 条件筛选
   - 高级搜索
   - 批量搜索

2. **排序功能**
   - 单列排序
   - 多列排序

3. **分页功能**
   - 每页数量选择
   - 页码跳转
   - 首页/末页

4. **批量操作**
   - 全选/取消全选
   - 批量导出
   - 批量删除
   - 批量修改状态

5. **列自定义**
   - 显示/隐藏列
   - 列顺序调整
   - 列宽调整

---

## 九、表单系统

### 9.1 表单组件

- **Input**: 输入框
- **Textarea**: 多行文本框
- **Select**: 下拉选择
- **Checkbox**: 复选框
- **Radio**: 单选框
- **DatePicker**: 日期选择器
- **Switch**: 开关

### 9.2 表单验证

```typescript
// 使用react-hook-form + zod
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import * as z from 'zod'

const formSchema = z.object({
  name: z.string().min(2, '名称至少2个字符'),
  email: z.string().email('请输入有效的邮箱'),
})

function MyForm() {
  const form = useForm({
    resolver: zodResolver(formSchema),
  })
  
  // ...
}
```

---

## 十、性能优化

### 10.1 代码分割

- 使用动态导入 `next/dynamic`
- 路由级别代码分割
- 组件级别懒加载

### 10.2 图片优化

- 使用 `next/image` 组件
- 自动优化图片格式
- 响应式图片加载

### 10.3 字体优化

- 使用 `next/font` 加载字体
- 字体子集化
- 字体预加载

### 10.4 缓存策略

- 静态页面生成 (SSG)
- 增量静态再生成 (ISR)
- 客户端缓存

---

## 十一、开发规范

### 11.1 命名规范

- **组件**: PascalCase (如 `DataTable.tsx`)
- **函数**: camelCase (如 `handleClick`)
- **常量**: UPPER_SNAKE_CASE (如 `MAX_PAGE_SIZE`)
- **CSS类**: kebab-case (如 `data-table-header`)

### 11.2 文件组织

```
ComponentName/
├── index.tsx              # 组件主文件
├── ComponentName.tsx      # 组件实现
├── ComponentName.test.tsx # 测试文件
├── ComponentName.stories.tsx # Storybook
└── types.ts               # 类型定义
```

### 11.3 代码风格

- 使用 ESLint + Prettier
- 遵循 Airbnb JavaScript Style Guide
- TypeScript严格模式
- 组件使用函数式组件 + Hooks

### 11.4 注释规范

```typescript
/**
 * 数据表格组件
 * @param data - 表格数据
 * @param columns - 列配置
 * @param onRowClick - 行点击回调
 */
export function DataTable<T>({
  data,
  columns,
  onRowClick,
}: DataTableProps<T>) {
  // 实现
}
```

---

## 十二、测试要求

### 12.1 单元测试

- 使用 Jest + React Testing Library
- 测试覆盖率 ≥ 80%
- 关键业务逻辑必须测试

### 12.2 集成测试

- 使用 Playwright 或 Cypress
- 测试关键用户流程
- 测试跨浏览器兼容性

### 12.3 E2E测试

- 测试完整业务流程
- 测试异常情况处理
- 测试性能指标

---

## 十三、部署要求

### 13.1 构建命令

```bash
# 开发环境
npm run dev

# 生产构建
npm run build

# 启动生产服务器
npm run start

# 代码检查
npm run lint

# 类型检查
npm run type-check
```

### 13.2 环境变量

```env
# .env.local
NEXT_PUBLIC_API_URL=https://api.example.com
NEXT_PUBLIC_CDN_URL=https://cdn.example.com
```

### 13.3 部署平台

- **推荐**: Vercel (Next.js官方平台)
- **备选**: AWS, Azure, Google Cloud
- **自托管**: Docker + Nginx

---

## 十四、浏览器支持

### 14.1 支持的浏览器

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### 14.2 移动端支持

- iOS Safari 14+
- Android Chrome 90+

---

## 十五、安全要求

### 15.1 前端安全

- XSS防护
- CSRF防护
- 内容安全策略 (CSP)
- HTTPS强制

### 15.2 数据安全

- 敏感数据加密
- 安全的API调用
- Token管理
- 权限控制

---

## 十六、监控与日志

### 16.1 错误监控

- 使用 Sentry 或类似工具
- 捕获运行时错误
- 记录用户操作路径

### 16.2 性能监控

- Core Web Vitals
- 页面加载时间
- API响应时间
- 资源加载时间

---

## 十七、文档要求

### 17.1 必需文档

- README.md - 项目说明
- SETUP.md - 安装配置指南
- QUICK_START.md - 快速开始指南
- API.md - API文档
- CHANGELOG.md - 更新日志

### 17.2 代码文档

- 组件文档 (JSDoc)
- API文档
- 类型定义文档
- 业务流程文档

---

## 附录

### A. 常用命令

```bash
# 安装依赖
npm install

# 开发服务器
npm run dev

# 生产构建
npm run build

# 启动生产服务器
npm start

# 代码检查
npm run lint

# 格式化代码
npm run format

# 类型检查
npm run type-check

# 运行测试
npm test

# 生成组件
npm run generate:component
```

### B. 相关资源

- [Next.js文档](https://nextjs.org/docs)
- [React文档](https://react.dev/)
- [Tailwind CSS文档](https://tailwindcss.com/docs)
- [shadcn/ui文档](https://ui.shadcn.com/)
- [TypeScript文档](https://www.typescriptlang.org/docs/)

---

**文档维护**: 开发团队  
**最后更新**: 2024-12-31

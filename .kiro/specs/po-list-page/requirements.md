# 采购订单列表页需求文档

## 1. 功能概述

采购订单列表页是PO管理系统的核心页面，提供PO的查看、搜索、筛选、批量操作等功能。用户可以通过该页面快速定位目标PO，执行相应的业务操作，并获得PO状态的实时概览。

## 1.1. 页面结构

### 页面布局
- **页面标题区域**: 显示"采购订单"标题和描述信息
- **操作按钮区域**: 新增PO、导出等主要操作按钮
- **状态标签页区域**: 按PO状态分组的快速筛选标签
- **搜索筛选区域**: 搜索框、高级搜索、筛选器、列设置
- **批量操作区域**: 选中PO后显示的批量操作栏（条件显示）
- **数据表格区域**: PO列表数据展示
- **分页区域**: 分页控件和页面大小设置

### 响应式设计
- **桌面端**: 完整功能展示，表格横向滚动
- **平板端**: 适当调整列宽，隐藏次要列
- **手机端**: 卡片式布局，关键信息优先显示

## 1.2. 用户故事

### 主要用户角色
- **采购经理**: 需要查看所有PO的整体状态，进行批量管理
- **采购员**: 需要查看和操作自己负责的PO
- **仓库管理员**: 需要查看待收货的PO，执行收货操作
- **财务人员**: 需要查看PO的金额信息，进行成本分析

### 核心用户故事
1. 作为采购员，我希望能够快速找到特定的PO，以便及时处理业务
2. 作为采购经理，我希望能够看到各状态PO的数量分布，以便了解整体进度
3. 作为仓库管理员，我希望能够筛选出需要收货的PO，以便安排收货计划
4. 作为财务人员，我希望能够导出PO数据，以便进行财务分析

## 术语表

- **PO**: Purchase Order - 采购订单
- **PR**: Purchase Request - 采购申请
- **ASN**: Advance Ship Notice - 预发货通知
- **本地仓库**: 公司自有仓库，支持直接收货确认
- **第三方仓库**: 外部合作仓库，需要创建收货请求
- **系统**: 采购订单列表页系统

## 需求规格

### 需求1：页面标题和导航

**用户故事：** 作为用户，我希望能够清楚地知道当前页面的功能和位置，以便进行导航和操作。

#### 验收标准

1. 页面应显示"采购订单"作为主标题，字体大小为text-2xl，颜色为text-text-primary
2. 主标题下方应显示描述文字"管理采购订单"，字体大小为text-sm，颜色为text-text-secondary
3. 页面应显示当前模块名称"Purchase"在侧边栏中高亮显示
4. 页面应支持面包屑导航，显示"首页 > 采购管理 > 采购订单"
5. 页面标题区域应与操作按钮区域在同一行显示，左右对齐

### 需求2：主要操作按钮

**用户故事：** 作为采购员，我希望能够方便地创建新PO和导出数据，以便高效完成工作。

#### 验收标准

1. 页面右上角应显示"导出"按钮，支持导出当前筛选结果
2. 当有选中行时，导出按钮应显示"导出 (N)"，N为选中行数
3. 页面应显示"新增PO"下拉按钮，包含以下选项：
   - "手动创建PO" - 跳转到PO创建页面
   - "从文件导入PO" - 打开文件上传对话框
   - "下载模板PO" - 下载Excel模板文件
4. 导出按钮应使用outline样式，新增PO按钮应使用primary样式
5. 按钮应支持loading状态显示，防止重复点击
6. 按钮应有合适的图标：导出使用Download图标，新增使用Plus图标

### 需求3：状态标签页筛选

**用户故事：** 作为采购经理，我希望能够快速查看不同状态的PO数量和列表，以便了解整体进度。

#### 验收标准

1. 页面应显示状态标签页，包含以下标签：
   - "全部" - 显示所有PO
   - "新建" - 显示NEW状态的PO
   - "运输中" - 显示IN_TRANSIT状态的PO
   - "待收货" - 显示WAITING_FOR_RECEIVING状态的PO
   - "收货中" - 显示RECEIVING状态的PO
   - "部分收货" - 显示PARTIAL_RECEIPT状态的PO
   - "已关闭" - 显示CLOSED状态的PO
   - "已取消" - 显示CANCELLED状态的PO
   - "异常" - 显示EXCEPTION状态的PO

2. 每个标签应显示对应状态的PO数量，格式为"状态名 数量"
3. 当前激活的标签应有视觉高亮显示，使用primary颜色
4. 点击标签应立即筛选对应状态的PO，无需页面刷新
5. 标签数量应实时更新，反映当前筛选条件下的实际数量
6. 标签应支持响应式布局，在小屏幕上可横向滚动

### 需求4：搜索功能

**用户故事：** 作为采购员，我希望能够快速搜索特定的PO，以便快速定位目标订单。

#### 验收标准

1. 页面应提供搜索框，占位符文字为"搜索PO编号、原始PO编号、参考编号、供应商、目的地、PR编号"
2. 搜索应支持以下字段的模糊匹配：
   - PO编号 (orderNo)
   - 原始PO编号 (originalPoNo)  
   - 参考编号 (referenceNo)
   - 供应商名称 (supplierName)
   - 目的地 (destination)
   - 关联PR编号 (prNos数组中的任意值)

3. 搜索应实时触发，用户停止输入500ms后自动执行搜索
4. 搜索结果应高亮显示匹配的关键词
5. 搜索框应支持清空功能，点击清空后恢复全部数据
6. 搜索应与其他筛选条件组合生效，不会重置其他筛选条件
7. 搜索应支持中英文输入，不区分大小写

### 需求5：高级搜索功能

**用户故事：** 作为采购员，我希望能够进行更精确的多条件搜索，以便准确找到目标PO。

#### 验收标准

1. 页面应提供"高级搜索"按钮，点击后打开高级搜索对话框
2. 高级搜索对话框应包含以下搜索字段：
   - PO编号：支持批量搜索，换行分隔，最多100个
   - 原始PO编号：单个输入框
   - PR编号：支持批量搜索，换行分隔，最多100个  
   - 参考编号：单个输入框
   - 供应商名称：单个输入框，支持模糊匹配
   - 供应商编号：单个输入框

3. 批量搜索字段应显示输入提示："PO202403150001\nPO202403150002\nPO202403150003"
4. 高级搜索应支持字段组合查询，多个字段之间为AND关系
5. 搜索结果应在对话框关闭后立即显示在列表中
6. 高级搜索条件应在页面上显示为筛选标签，可单独移除
7. 高级搜索应支持保存搜索条件，方便重复使用

### 需求6：筛选器功能

**用户故事：** 作为用户，我希望能够按不同维度筛选PO，以便快速找到符合条件的订单。

#### 验收标准

1. 页面应提供筛选器功能，包含以下筛选维度：

   **状态筛选**：
   - 主状态：NEW、IN_TRANSIT、WAITING_FOR_RECEIVING、RECEIVING、PARTIAL_RECEIPT、CLOSED、CANCELLED、EXCEPTION
   - 运输状态：SHIPPED、IN_TRANSIT、ARRIVED、SHIPPING_EXCEPTION
   - 收货状态：NOT_RECEIVED、PARTIAL_RECEIVED、RECEIVED、FULLY_RECEIVED、OVER_RECEIVED

   **供应商筛选**：
   - 支持多选，显示常用供应商列表
   - 支持搜索供应商名称

   **仓库筛选**：
   - 按目标仓库城市筛选：Los Angeles、New York、Seattle、Chicago、Miami、Boston
   - 支持多选

   **数据来源筛选**：
   - MANUAL（手动创建）
   - PR_CONVERSION（PR转换）
   - API_IMPORT（API导入）

2. 筛选器应支持多选，同一维度内为OR关系，不同维度间为AND关系
3. 已选择的筛选条件应显示为标签，可单独移除
4. 筛选器应显示每个选项对应的PO数量
5. 筛选结果应实时更新，无需手动刷新
6. 筛选器应支持全部清空功能

### 需求7：列显示设置

**用户故事：** 作为用户，我希望能够自定义表格显示的列，以便查看我关心的信息。

#### 验收标准

1. 页面应提供"列设置"按钮，点击后显示列选择下拉菜单
2. 列设置应包含以下可选列：

   **默认显示列**：
   - PO编号 (orderNo) - 150px宽度
   - 状态 (status) - 140px宽度  
   - 原始PO编号 (originalPoNo) - 160px宽度
   - 参考编号 (referenceNo) - 150px宽度
   - 运输状态 (shippingStatus) - 140px宽度
   - 收货状态 (receivingStatus) - 140px宽度
   - 供应商名称 (supplierName) - 200px宽度
   - 仓库名称 (warehouseName) - 180px宽度
   - 总订购数量 (totalOrderQty) - 120px宽度
   - 总价 (totalPrice) - 140px宽度
   - 创建时间 (created) - 180px宽度
   - 预计到货日期 (expectedArrivalDate) - 180px宽度
   - 操作 (actions) - 80px宽度

   **可选显示列**：
   - 已发运数量 (shippedQty) - 120px宽度
   - 已收货数量 (receivedQty) - 120px宽度
   - ASN数量 (asnCount) - 100px宽度
   - 数据来源 (dataSource) - 120px宽度
   - PR编号 (prNos) - 200px宽度
   - 异常信息 (exceptions) - 100px宽度
   - 承运商 (shippingCarrier) - 150px宽度
   - 目标城市 (toCity) - 120px宽度
   - 目标州省 (toState) - 100px宽度
   - 目标国家 (toCountry) - 120px宽度
   - 更新时间 (updated) - 180px宽度
   - 运输方式 (shippingService) - 150px宽度
   - 运输备注 (shippingNotes) - 200px宽度
   - 采购日期 (purchaseOrderDate) - 180px宽度

3. 列设置应支持勾选/取消勾选来控制列的显示/隐藏
4. 列设置应保存用户的选择，下次访问时保持设置
5. 第一列（PO编号）和最后一列（操作）应为粘性列，始终可见
6. 列设置应支持恢复默认设置功能

### 需求8：数据表格显示

**用户故事：** 作为用户，我希望能够清晰地查看PO的关键信息，以便快速了解订单状态。

#### 验收标准

1. **PO编号列**：
   - 显示为可点击的链接样式，点击跳转到PO详情页
   - 使用OrderNumberCell组件，支持复制功能
   - 字体使用font-mono样式

2. **状态列**：
   - 使用StatusBadge组件显示，支持中英文切换
   - 不同状态使用不同颜色：
     - NEW: 灰色 (text-text-secondary)
     - IN_TRANSIT: 蓝色 (text-primary)
     - WAITING_FOR_RECEIVING: 蓝色 (text-primary)
     - RECEIVING: 蓝色 (text-primary)
     - PARTIAL_RECEIPT: 橙色 (text-warning)
     - CLOSED: 绿色 (text-success)
     - CANCELLED: 灰色 (text-text-secondary)
     - EXCEPTION: 红色 (text-destructive)

3. **原始PO编号列**：
   - 使用OrderNumberCell组件，灰色显示 (text-muted-foreground)
   - 支持复制功能

4. **运输状态和收货状态列**：
   - 使用StatusBadge组件，如果状态为空显示"-"
   - 支持鼠标悬停显示状态说明

5. **仓库名称列**：
   - 本地仓库显示"本地仓库"
   - 第三方仓库显示实际仓库名称

6. **数量列**：
   - 总订购数量：使用千分位分隔符格式化
   - 已发运数量：显示数量和百分比，居中对齐
   - 已收货数量：显示数量和百分比，居中对齐

7. **ASN数量列**：
   - 居中显示，使用text-text-secondary颜色

8. **数据来源列**：
   - MANUAL显示"手动创建"
   - PR_CONVERSION显示"PR转换"  
   - API_IMPORT显示"API导入"

9. **总价列**：
   - 右对齐显示，格式为"币种 金额"
   - 使用千分位分隔符，字体为font-medium

10. **时间列**：
    - 创建时间和更新时间使用本地化格式显示
    - 预计到货日期仅显示日期部分

11. **PR编号列**：
    - 显示前2个PR编号，超过2个显示"+N"
    - 使用小字体和灰色显示

12. **异常信息列**：
    - 有异常时显示红色警告图标和异常数量
    - 无异常时显示"-"

### 需求9：行选择功能

**用户故事：** 作为用户，我希望能够选择多个PO进行批量操作，以便提高工作效率。

#### 验收标准

1. 表格第一列应显示复选框，支持单行选择
2. 表头应显示全选复选框，支持全选/取消全选当前页面的所有行
3. 选中的行应有视觉高亮显示，使用data-state="selected"样式
4. 选择状态应在页面切换时保持，基于PO的ID进行跟踪
5. 全选复选框应根据当前页面的选择状态显示：
   - 全部选中：勾选状态
   - 部分选中：半选状态（indeterminate）
   - 全部未选中：未勾选状态
6. 选择功能应支持键盘操作，Space键切换选择状态
7. 选中行数应在页面底部显示："已选择 N 行"

### 需求10：批量操作功能

**用户故事：** 作为采购员，我希望能够对选中的多个PO执行批量操作，以便快速处理大量订单。

#### 验收标准

1. 当有选中行时，页面应显示批量操作栏，包含以下信息：
   - 左侧：显示"已选择 N 项"和"清空选择"按钮
   - 右侧：批量操作按钮组

2. 批量操作栏应使用Card组件，带有primary色调的边框和背景

3. **通用批量操作**（适用于所有状态组合）：
   - "批量导出"：导出选中PO的详细信息
   - "批量打印"：打印选中PO的单据

4. **状态相关批量操作**（仅当选中PO状态一致时显示）：
   
   **NEW状态**：
   - "批量发送"：批量发送给供应商
   - "批量创建发运单"：批量创建ASN
   - "批量创建收货单"：批量直接收货
   - "批量取消"：批量取消订单

   **IN_TRANSIT状态**：
   - "批量创建发运单"：批量创建补充ASN
   - "批量标记送达"：批量标记货物已到达

   **WAITING_FOR_RECEIVING状态**：
   - "批量创建发运单"：批量创建补充ASN
   - "批量创建收货单"：批量开始收货

   **RECEIVING状态**：
   - "批量创建发运单"：批量创建补充ASN

   **PARTIAL_RECEIPT状态**：
   - "批量创建发运单"：批量创建补充ASN
   - "批量创建收货单"：批量继续收货

   **CANCELLED状态**：
   - "批量重开"：批量重新激活订单

   **EXCEPTION状态**：
   - "批量重开"：批量重新激活订单

5. 批量操作应在执行前显示确认对话框，列出将要操作的PO编号
6. 批量操作应支持部分成功的情况，显示成功和失败的详细结果
7. 批量操作完成后应自动刷新列表数据和清空选择

### 需求11：行级操作功能

**用户故事：** 作为用户，我希望能够对单个PO执行相应的操作，以便处理具体的业务需求。

#### 验收标准

1. 操作列应显示下拉菜单按钮，使用MoreVertical图标
2. 点击操作按钮应阻止事件冒泡，不触发行点击事件
3. 操作菜单应根据PO状态和仓库类型显示不同的操作选项：

   **NEW状态**：
   - "发送" - 发送给供应商确认
   - "创建发运单" - 跳转到发运单创建页面
   - "创建收货单" - 本地仓库打开收货对话框，第三方仓库跳转收货页面
   - "取消" - 取消采购订单，使用destructive样式

   **IN_TRANSIT状态**：
   - "查看" - 跳转到PO详情页
   - "创建发运单" - 创建补充发运单
   - "标记送达" - 标记货物已到达，更新状态

   **WAITING_FOR_RECEIVING状态**：
   - "查看" - 跳转到PO详情页
   - "创建发运单" - 创建补充发运单
   - "创建收货单" - 开始收货流程

   **RECEIVING状态**：
   - "查看" - 跳转到PO详情页
   - "创建发运单" - 创建补充发运单

   **PARTIAL_RECEIPT状态**：
   - "查看" - 跳转到PO详情页
   - "创建发运单" - 创建补充发运单
   - "创建收货单" - 继续收货流程

   **CLOSED状态**：
   - "查看" - 跳转到PO详情页
   - "复制" - 复制为新订单

   **CANCELLED状态**：
   - "查看" - 跳转到PO详情页
   - "重开" - 重新激活订单
   - "复制" - 复制为新订单

   **EXCEPTION状态**：
   - "查看" - 跳转到PO详情页
   - "重开" - 重新激活订单
   - "复制" - 复制为新订单
   - "查看原因" - 查看异常详情

4. 仓库类型判断规则：
   - 本地仓库：warehouseMap中type为"LOCAL_WAREHOUSE"
   - 第三方仓库：warehouseMap中type为"THIRD_PARTY"

5. 操作执行后应提供相应的反馈：
   - 成功操作：显示成功提示
   - 失败操作：显示错误信息
   - 状态变更：自动刷新列表数据

### 需求12：分页功能

**用户故事：** 作为用户，我希望能够方便地浏览大量PO数据，以便高效查看信息。

#### 验收标准

1. 页面底部应显示分页控件，包含以下元素：
   - 左侧：选中行数显示（如有选中行）
   - 中间：页面大小设置和当前页面信息
   - 右侧：分页导航按钮

2. **页面大小设置**：
   - 支持选择：10、20、50、100条/页
   - 默认显示10条/页
   - 更改页面大小时自动跳转到第一页

3. **当前页面信息**：
   - 显示格式："显示第 X 到 Y 条，共 Z 条记录"
   - 实时反映当前筛选条件下的数据

4. **分页导航**：
   - 首页按钮：跳转到第一页，当前为第一页时禁用
   - 上一页按钮：跳转到上一页，当前为第一页时禁用
   - 页码显示：显示"第 X 页，共 Y 页"
   - 下一页按钮：跳转到下一页，当前为最后一页时禁用
   - 末页按钮：跳转到最后一页，当前为最后一页时禁用

5. 分页状态应在筛选条件变更时重置到第一页
6. 分页应支持URL参数，支持直接访问特定页面
7. 分页控件应支持键盘导航

### 需求13：数据加载和错误处理

**用户故事：** 作为用户，我希望系统能够稳定地加载数据并处理异常情况，以便获得良好的使用体验。

#### 验收标准

1. **加载状态**：
   - 初始加载时显示骨架屏或加载动画
   - 搜索和筛选时显示loading状态
   - 批量操作时显示进度指示

2. **空数据状态**：
   - 无数据时显示友好的空状态提示
   - 提供相关的操作建议，如"创建第一个PO"

3. **错误处理**：
   - 网络错误时显示错误提示和重试按钮
   - 权限错误时显示相应的权限提示
   - 服务器错误时显示通用错误信息

4. **数据刷新**：
   - 支持手动刷新功能
   - 支持自动刷新（可配置间隔）
   - 刷新时保持当前的筛选和分页状态

5. **性能优化**：
   - 支持虚拟滚动（当数据量很大时）
   - 支持数据缓存，减少重复请求
   - 支持增量加载，提高响应速度

### 需求14：国际化支持

**用户故事：** 作为国际用户，我希望系统能够支持我的语言，以便更好地使用系统。

#### 验收标准

1. 页面应支持中英文切换，通过useI18n hook实现
2. 所有文本内容应使用t()函数进行国际化处理
3. 状态标签应支持多语言显示：
   - 中文：新建、运输中、待收货、收货中、部分收货、已关闭、已取消、异常
   - 英文：New、In Transit、Pending Receipt、Receiving、Partial Receipt、Closed、Cancelled、Exception

4. 操作按钮应支持多语言：
   - 中文：查看、编辑、发送、创建发运单、创建收货单、取消、重开、复制、查看原因
   - 英文：View、Edit、Send、Create Shipment、Create Receipt、Cancel、Reopen、Copy、View Reason

5. 时间格式应根据语言设置显示本地化格式
6. 数字格式应使用对应语言的千分位分隔符
7. 语言切换应立即生效，无需页面刷新

### 需求15：响应式设计

**用户故事：** 作为移动端用户，我希望能够在不同设备上正常使用PO列表功能，以便随时处理业务。

#### 验收标准

1. **桌面端（≥1024px）**：
   - 显示完整的表格布局
   - 支持横向滚动查看所有列
   - 粘性列功能正常工作

2. **平板端（768px-1023px）**：
   - 自动隐藏次要列，保留核心信息列
   - 调整按钮和控件大小，适合触控操作
   - 保持主要功能可用

3. **手机端（<768px）**：
   - 切换为卡片式布局，每个PO显示为一个卡片
   - 卡片显示关键信息：PO编号、状态、供应商、金额
   - 支持卡片点击查看详情
   - 简化操作菜单，保留核心操作

4. 所有设备应保持功能完整性，核心业务流程不受影响
5. 触控设备应有合适的触控目标大小（最小44px）
6. 响应式断点应使用Tailwind CSS的标准断点

### 需求16：性能要求

**用户故事：** 作为用户，我希望系统响应迅速，以便高效完成工作。

#### 验收标准

1. **页面加载性能**：
   - 初始页面加载时间不超过2秒
   - 数据获取和渲染时间不超过1秒
   - 搜索和筛选响应时间不超过500ms

2. **大数据量处理**：
   - 支持显示至少10000条PO记录
   - 使用虚拟滚动技术优化长列表性能
   - 分页加载，避免一次性加载过多数据

3. **内存使用**：
   - 页面内存使用控制在合理范围内
   - 避免内存泄漏，正确清理事件监听器
   - 优化图片和资源加载

4. **网络优化**：
   - 使用数据缓存减少重复请求
   - 支持请求防抖，避免频繁请求
   - 压缩传输数据，减少网络开销

5. **用户体验**：
   - 操作响应及时，无明显延迟感
   - 平滑的动画和过渡效果
   - 合理的加载状态提示